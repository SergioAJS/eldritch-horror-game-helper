const ancientsData = [
  {
    id: 'azathoth',
    name: 'azathoth',
    // cardFace: Ancients.azathoth,
    firstStage: {
      greenCards: 1,
      blueCards: 1,
      brownCards: 2,
    },
    secondStage: {
      greenCards: 2,
      blueCards: 1,
      brownCards: 3,
    },
    thirdStage: {
      greenCards: 2,
      blueCards: 0,
      brownCards: 4,
    },
  },
  {
    id: 'cthulhu',
    name: 'cthulhu',
    // cardFace: Ancients.cthulhu,
    firstStage: {
      greenCards: 0,
      blueCards: 2,
      brownCards: 2,
    },
    secondStage: {
      greenCards: 1,
      blueCards: 0,
      brownCards: 3,
    },
    thirdStage: {
      greenCards: 3,
      blueCards: 0,
      brownCards: 4,
    },
  },
  {
    id: 'iogSothoth',
    name: 'iogSothoth',
    // cardFace: Ancients.iogSothoth,
    firstStage: {
      greenCards: 0,
      blueCards: 1,
      brownCards: 2,
    },
    secondStage: {
      greenCards: 2,
      blueCards: 1,
      brownCards: 3,
    },
    thirdStage: {
      greenCards: 3,
      blueCards: 0,
      brownCards: 4,
    },
  },
  {
    id: 'shubNiggurath',
    name: 'shubNiggurath',
    // cardFace: Ancients.shubNiggurath,
    firstStage: {
      greenCards: 1,
      blueCards: 1,
      brownCards: 2,
    },
    secondStage: {
      greenCards: 3,
      blueCards: 1,
      brownCards: 2,
    },
    thirdStage: {
      greenCards: 2,
      blueCards: 0,
      brownCards: 4,
    },
  },
]

const greenCards = [
    {
      id: 'green1',
      cardFace: './assets/MythicCards/green/green1.png',
      difficulty: 'easy',
      color:'green'
    },
    {
      id: 'green2',
      cardFace: './assets/MythicCards/green/green2.png',
      difficulty: 'hard',
      color:'green'
    },
    {
      id: 'green3',
      cardFace: './assets/MythicCards/green/green3.png',
      difficulty: 'hard',
      color:'green'
    },
    {
      id: 'green4',
      cardFace: './assets/MythicCards/green/green4.png',
      difficulty: 'hard',
      color:'green'
    },
    {
      id: 'green5',
      cardFace: './assets/MythicCards/green/green5.png',
      difficulty: 'hard',
      color:'green'
    },
    {
      id: 'green6',
      cardFace: './assets/MythicCards/green/green6.png',
      difficulty: 'hard',
      color:'green'
    },
    {
      id: 'green7',
      cardFace: './assets/MythicCards/green/green7.png',
      difficulty: 'normal',
      color:'green'
    },
    {
      id: 'green8',
      cardFace: './assets/MythicCards/green/green8.png',
      difficulty: 'normal',
      color:'green'
    },
    {
      id: 'green9',
      cardFace: './assets/MythicCards/green/green9.png',
      difficulty: 'normal',
      color:'green'
    },
    {
      id: 'green10',
      cardFace: './assets/MythicCards/green/green10.png',
      difficulty: 'normal',
      color:'green'
    },
    {
      id: 'green11',
      cardFace: './assets/MythicCards/green/green11.png',
      difficulty: 'normal',
      color:'green'
    },
    {
      id: 'green12',
      cardFace: './assets/MythicCards/green/green12.png',
      difficulty: 'easy',
      color:'green'
    },
    {
      id: 'green13',
      cardFace: './assets/MythicCards/green/green13.png',
      difficulty: 'normal',
      color:'green'
    },
    {
      id: 'green14',
      cardFace: './assets/MythicCards/green/green14.png',
      difficulty: 'normal',
      color:'green'
    },
    {
      id: 'green15',
      cardFace: './assets/MythicCards/green/green15.png',
      difficulty: 'normal',
      color:'green'
    },
    {
      id: 'green16',
      cardFace: './assets/MythicCards/green/green16.png',
      difficulty: 'easy',
      color:'green'
    },
    {
      id: 'green17',
      cardFace: './assets/MythicCards/green/green17.png',
      difficulty: 'easy',
      color:'green'
    },
    {
      id: 'green18',
      cardFace: './assets/MythicCards/green/green18.png',
      difficulty: 'easy',
      color:'green'
    },
]

const brownCards = [
    {
      id: 'brown1',
      cardFace: './assets/MythicCards/brown/brown1.png',
      difficulty: 'normal',
      color:'brown'
    },
    {
      id: 'brown2',
      cardFace: './assets/MythicCards/brown/brown2.png',
      difficulty: 'normal',
      color:'brown'
    },
    {
      id: 'brown3',
      cardFace: './assets/MythicCards/brown/brown3.png',
      difficulty: 'normal',
      color:'brown'
    },
    {
      id: 'brown4',
      cardFace: './assets/MythicCards/brown/brown4.png',
      difficulty: 'normal',
      color:'brown'
    },
    {
      id: 'brown5',
      cardFace: './assets/MythicCards/brown/brown5.png',
      difficulty: 'normal',
      color:'brown'
    },
    {
      id: 'brown6',
      cardFace: './assets/MythicCards/brown/brown6.png',
      difficulty: 'hard',
      color:'brown'
    },
    {
      id: 'brown7',
      cardFace: './assets/MythicCards/brown/brown7.png',
      difficulty: 'hard',
      color:'brown'
    },
    {
      id: 'brown8',
      cardFace: './assets/MythicCards/brown/brown8.png',
      difficulty: 'hard',
      color:'brown'
    },
    {
      id: 'brown9',
      cardFace: './assets/MythicCards/brown/brown9.png',
      difficulty: 'hard',
      color:'brown'
    },
    {
      id: 'brown10',
      cardFace: './assets/MythicCards/brown/brown10.png',
      difficulty: 'hard',
      color:'brown'
    },
    {
      id: 'brown11',
      cardFace: './assets/MythicCards/brown/brown11.png',
      difficulty: 'easy',
      color:'brown'
    },
    {
      id: 'brown12',
      cardFace: './assets/MythicCards/brown/brown12.png',
      difficulty: 'easy',
      color:'brown'
    },
    {
      id: 'brown13',
      cardFace: './assets/MythicCards/brown/brown13.png',
      difficulty: 'easy',
      color:'brown'
    },
    {
      id: 'brown14',
      cardFace: './assets/MythicCards/brown/brown14.png',
      difficulty: 'easy',
      color:'brown'
    },
    {
      id: 'brown15',
      cardFace: './assets/MythicCards/brown/brown15.png',
      difficulty: 'normal',
      color:'brown'
    },
    {
      id: 'brown16',
      cardFace: './assets/MythicCards/brown/brown16.png',
      difficulty: 'normal',
      color:'brown'
    },
    {
      id: 'brown17',
      cardFace: './assets/MythicCards/brown/brown17.png',
      difficulty: 'normal',
      color:'brown'
    },
    {
      id: 'brown18',
      cardFace: './assets/MythicCards/brown/brown18.png',
      difficulty: 'normal',
      color:'brown'
    },
    {
      id: 'brown19',
      cardFace: './assets/MythicCards/brown/brown19.png',
      difficulty: 'normal',
      color:'brown'
    },
    {
      id: 'brown20',
      cardFace: './assets/MythicCards/brown/brown20.png',
      difficulty: 'normal',
      color:'brown'
    },
    {
      id: 'brown21',
      cardFace: './assets/MythicCards/brown/brown21.png',
      difficulty: 'easy',
      color:'brown'
    },
]

const blueCards = [
    {
      id: 'blue1',
      cardFace: './assets/MythicCards/blue/blue1.png',
      difficulty: 'hard',
      color:'blue'
    },
    {
      id: 'blue2',
      cardFace: './assets/MythicCards/blue/blue2.png',
      difficulty: 'hard',
      color:'blue'
    },
    {
      id: 'blue3',
      cardFace: './assets/MythicCards/blue/blue3.png',
      difficulty: 'easy',
      color:'blue'
    },
    {
      id: 'blue4',
      cardFace: './assets/MythicCards/blue/blue4.png',
      difficulty: 'easy',
      color:'blue'
    },
    {
      id: 'blue5',
      cardFace: './assets/MythicCards/blue/blue5.png',
      difficulty: 'easy',
      color:'blue'
    },
    {
      id: 'blue6',
      cardFace: './assets/MythicCards/blue/blue6.png',
      difficulty: 'hard',
      color:'blue'
    },
    {
      id: 'blue7',
      cardFace: './assets/MythicCards/blue/blue7.png',
      difficulty: 'normal',
      color:'blue'
    },
    {
      id: 'blue8',
      cardFace: './assets/MythicCards/blue/blue8.png',
      difficulty: 'hard',
      color:'blue'
    },
    {
      id: 'blue9',
      cardFace: './assets/MythicCards/blue/blue9.png',
      difficulty: 'normal',
      color:'blue'
    },
    {
      id: 'blue10',
      cardFace: './assets/MythicCards/blue/blue10.png',
      difficulty: 'easy',
      color:'blue'
    },
    {
      id: 'blue11',
      cardFace: './assets/MythicCards/blue/blue11.png',
      difficulty: 'normal',
      color:'blue'
    },
    {
      id: 'blue12',
      cardFace: './assets/MythicCards/blue/blue12.png',
      difficulty: 'normal',
      color:'blue'
    },
]

const ancientsContainer = document.querySelector('.ancients-container');
const difficultyContainer = document.querySelector('.difficulty-container');
const shuffleButton = document.querySelector('.shuffle-button');
const currentState = document.querySelector('.current-state');
const deck = document.querySelector('.deck');
const lastCard = document.querySelector('.last-card');
const green = document.querySelectorAll('.green');
const brown = document.querySelectorAll('.brown');
const blue = document.querySelectorAll('.blue');
const stageText = document.querySelectorAll('.stage-text');

let selectedAncient;
let selectedDifficulty;
let formedDeck = [];

ancientsContainer.onclick = function(event) {
    let target = event.target;
    if (target.className !== 'ancient-card') return;
    highlightAncient(target);
    difficultyContainer.classList.remove('hidden');
    playAncient = selectedAncient.alt;
}

function highlightAncient(ancient) {
    if (selectedAncient) {
        selectedAncient.classList.remove('active');
        shuffleButton.classList.remove('remove');
    }
    selectedAncient = ancient;
    selectedAncient.classList.add('active');
    currentState.classList.add('remove');
    deck.classList.add('remove');
    lastCard.classList.add('remove');
}


difficultyContainer.onclick = function(event) {
    let target = event.target;
    if (target.className !== 'difficulty') return;
    highlightDifficulty(target);
    shuffleButton.classList.remove('remove');
    playDiff = selectedDifficulty.innerText;
}

function highlightDifficulty(difficulty) {
    if (selectedDifficulty) {
        selectedDifficulty.classList.remove('active');
    }
    selectedDifficulty = difficulty;
    selectedDifficulty.classList.add('active');
    currentState.classList.add('remove');
    deck.classList.add('remove');
    lastCard.classList.add('remove');
    lastCard.style.backgroundImage = null;  
}

let playAncientNum = 0;

shuffleButton.addEventListener('click', () => {
    shuffleButton.classList.add('remove');
    currentState.classList.remove('remove');
    deck.classList.remove('remove');
    lastCard.classList.remove('remove');
    deck.style.backgroundImage = `url('./assets/mythicCardBackground.png')`;
    lastCard.style.backgroundImage = null;
    stageText[0].style.color = 'purple';
    stageText[1].style.color = 'purple';
    stageText[2].style.color = 'purple';    
    if (playAncient === 'Azathoth') {
        green[0].innerText = ancientsData[0].firstStage.greenCards;
        green[1].innerText = ancientsData[0].secondStage.greenCards;
        green[2].innerText = ancientsData[0].thirdStage.greenCards;
        brown[0].innerText = ancientsData[0].firstStage.brownCards;
        brown[1].innerText = ancientsData[0].secondStage.brownCards;
        brown[2].innerText = ancientsData[0].thirdStage.brownCards;
        blue[0].innerText = ancientsData[0].firstStage.blueCards;
        blue[1].innerText = ancientsData[0].secondStage.blueCards;
        blue[2].innerText = ancientsData[0].thirdStage.blueCards;
        playAncientNum = 0;
    } else if (playAncient === 'Cthulthu') {
        green[0].innerText = ancientsData[1].firstStage.greenCards;
        green[1].innerText = ancientsData[1].secondStage.greenCards;
        green[2].innerText = ancientsData[1].thirdStage.greenCards;
        brown[0].innerText = ancientsData[1].firstStage.brownCards;
        brown[1].innerText = ancientsData[1].secondStage.brownCards;
        brown[2].innerText = ancientsData[1].thirdStage.brownCards;
        blue[0].innerText = ancientsData[1].firstStage.blueCards;
        blue[1].innerText = ancientsData[1].secondStage.blueCards;
        blue[2].innerText = ancientsData[1].thirdStage.blueCards;
        playAncientNum = 1;
    } else if (playAncient === 'IogSothoth') {
        green[0].innerText = ancientsData[2].firstStage.greenCards;
        green[1].innerText = ancientsData[2].secondStage.greenCards;
        green[2].innerText = ancientsData[2].thirdStage.greenCards;
        brown[0].innerText = ancientsData[2].firstStage.brownCards;
        brown[1].innerText = ancientsData[2].secondStage.brownCards;
        brown[2].innerText = ancientsData[2].thirdStage.brownCards;
        blue[0].innerText = ancientsData[2].firstStage.blueCards;
        blue[1].innerText = ancientsData[2].secondStage.blueCards;
        blue[2].innerText = ancientsData[2].thirdStage.blueCards;
        playAncientNum = 2;
    } else {
        green[0].innerText = ancientsData[3].firstStage.greenCards;
        green[1].innerText = ancientsData[3].secondStage.greenCards;
        green[2].innerText = ancientsData[3].thirdStage.greenCards;
        brown[0].innerText = ancientsData[3].firstStage.brownCards;
        brown[1].innerText = ancientsData[3].secondStage.brownCards;
        brown[2].innerText = ancientsData[3].thirdStage.brownCards;
        blue[0].innerText = ancientsData[3].firstStage.blueCards;
        blue[1].innerText = ancientsData[3].secondStage.blueCards;
        blue[2].innerText = ancientsData[3].thirdStage.blueCards;
        playAncientNum = 3;
    }
    formDeck(playDiff);
})

deck.addEventListener('click', () => {
  getCard();
})

function getCard() {
  let currentCardNum = random(formedDeck.length - 1);
  let currentCard = formedDeck[currentCardNum];
  if (green[0].innerText > 0 || brown[0].innerText > 0 || blue[0].innerText > 0) {
    if (green[0].innerText > 0 && currentCard.color === 'green') {
      green[0].innerText = green[0].innerText - 1;
      lastCard.style.backgroundImage = `url('${currentCard.cardFace}')`;
      formedDeck.splice(currentCardNum, 1);
    } else if (brown[0].innerText > 0 && currentCard.color === 'brown') {
      brown[0].innerText = brown[0].innerText - 1;
      lastCard.style.backgroundImage = `url('${currentCard.cardFace}')`;
      formedDeck.splice(currentCardNum, 1);
    } else if (blue[0].innerText > 0 && currentCard.color === 'blue') {
      blue[0].innerText = blue[0].innerText - 1;
      lastCard.style.backgroundImage = `url('${currentCard.cardFace}')`;
      formedDeck.splice(currentCardNum, 1);
    } else {
      getCard();
    }
  } else if (green[1].innerText > 0 || brown[1].innerText > 0 || blue[1].innerText > 0) {
    stageText[0].style.color = 'red';
    if (green[1].innerText > 0 && currentCard.color === 'green') {
      green[1].innerText = green[1].innerText - 1;
      lastCard.style.backgroundImage = `url('${currentCard.cardFace}')`;
      formedDeck.splice(currentCardNum, 1);
    } else if (brown[1].innerText > 0 && currentCard.color === 'brown') {
      brown[1].innerText = brown[1].innerText - 1;
      lastCard.style.backgroundImage = `url('${currentCard.cardFace}')`;
      formedDeck.splice(currentCardNum, 1);
    } else if (blue[1].innerText > 0 && currentCard.color === 'blue') {
      blue[1].innerText = blue[1].innerText - 1;
      lastCard.style.backgroundImage = `url('${currentCard.cardFace}')`;
      formedDeck.splice(currentCardNum, 1);
    } else {
      getCard();
    }
  } else if ((green[2].innerText > 0 || brown[2].innerText > 0 || blue[2].innerText > 0) && formedDeck.length > 1) {
    stageText[1].style.color = 'red';
    if (green[2].innerText > 0 && currentCard.color === 'green') {
      green[2].innerText = green[2].innerText - 1;
      lastCard.style.backgroundImage = `url('${currentCard.cardFace}')`;
      formedDeck.splice(currentCardNum, 1);
    } else if (brown[2].innerText > 0 && currentCard.color === 'brown') {
      brown[2].innerText = brown[2].innerText - 1;
      lastCard.style.backgroundImage = `url('${currentCard.cardFace}')`;
      formedDeck.splice(currentCardNum, 1);
    } else if (blue[2].innerText > 0 && currentCard.color === 'blue') {
      blue[2].innerText = blue[2].innerText - 1;
      lastCard.style.backgroundImage = `url('${currentCard.cardFace}')`;
      formedDeck.splice(currentCardNum, 1);
    } else {
      getCard();
    }
  } else if (formedDeck.length === 1){
    stageText[2].style.color = 'red';
    if (green[2].innerText > 0 && currentCard.color === 'green') {
      green[2].innerText = green[2].innerText - 1;
      lastCard.style.backgroundImage = `url('${currentCard.cardFace}')`;
      formedDeck.splice(currentCardNum, 1);
      deck.style.backgroundImage = null;
    } else if (brown[2].innerText > 0 && currentCard.color === 'brown') {
      brown[2].innerText = brown[2].innerText - 1;
      lastCard.style.backgroundImage = `url('${currentCard.cardFace}')`;
      formedDeck.splice(currentCardNum, 1);
      deck.style.backgroundImage = null;
    } else if (blue[2].innerText > 0 && currentCard.color === 'blue') {
      blue[2].innerText = blue[2].innerText - 1;
      lastCard.style.backgroundImage = `url('${currentCard.cardFace}')`;
      formedDeck.splice(currentCardNum, 1);
      deck.style.backgroundImage = null;
    } else {
      getCard();
    }
  }
}

function random(num) {
    return Math.floor(Math.random() * (num + 1));
}

function formDeck (playDiff) {
    let greenSet = new Set;
    let brownSet = new Set;
    let blueSet = new Set;
    let greenCardsNum = ancientsData[playAncientNum].firstStage.greenCards + ancientsData[playAncientNum].secondStage.greenCards + ancientsData[playAncientNum].thirdStage.greenCards;
    let brownCardsNum = ancientsData[playAncientNum].firstStage.brownCards + ancientsData[playAncientNum].secondStage.brownCards + ancientsData[playAncientNum].thirdStage.brownCards;
    let blueCardsNum = ancientsData[playAncientNum].firstStage.blueCards + ancientsData[playAncientNum].secondStage.blueCards + ancientsData[playAncientNum].thirdStage.blueCards;
    const greenNum = greenCards.length - 1;
    const brownNum = brownCards.length - 1;
    const blueNum = blueCards.length - 1;
    if (playDiff === 'Средняя') {
        while ([...greenSet].length < greenCardsNum) {
          cardNum = random(greenNum);
          greenSet.add(greenCards[cardNum]);
        }
        while ([...brownSet].length < brownCardsNum) {
          cardNum = random(brownNum);
          brownSet.add(brownCards[cardNum]);
        }
        while ([...blueSet].length < blueCardsNum) {
          cardNum = random(blueNum);
          blueSet.add(blueCards[cardNum]);
        }
        formedDeck = [...greenSet].concat([...brownSet], [...blueSet]);
    } else if (playDiff === 'Высокая') {
      while ([...greenSet].length < greenCardsNum) {
        cardNum = random(greenNum);
        if (greenCards[cardNum].difficulty !== 'easy') {
          greenSet.add(greenCards[cardNum]);
        }
      }
      while ([...brownSet].length < brownCardsNum) {
        cardNum = random(brownNum);
        if (brownCards[cardNum].difficulty !== 'easy') {
          brownSet.add(brownCards[cardNum]);
        }
      }
      while ([...blueSet].length < blueCardsNum) {
        cardNum = random(blueNum);
        if (blueCards[cardNum].difficulty !== 'easy') {
          blueSet.add(blueCards[cardNum]);
        }
      }
      formedDeck = [...greenSet].concat([...brownSet], [...blueSet]);
    } else if (playDiff === 'Низкая') {
      while ([...greenSet].length < greenCardsNum) {
        cardNum = random(greenNum);
        if (greenCards[cardNum].difficulty !== 'hard') {
          greenSet.add(greenCards[cardNum]);
        }
      }
      while ([...brownSet].length < brownCardsNum) {
        cardNum = random(brownNum);
        if (brownCards[cardNum].difficulty !== 'hard') {
          brownSet.add(brownCards[cardNum]);
        }
      }
      while ([...blueSet].length < blueCardsNum) {
        cardNum = random(blueNum);
        if (blueCards[cardNum].difficulty !== 'hard') {
          blueSet.add(blueCards[cardNum]);
        }
      }
      formedDeck = [...greenSet].concat([...brownSet], [...blueSet]);
    } else if (playDiff === 'Очень низкая') {
      while ([...greenSet].length < greenCardsNum) {
        cardNum = random(greenNum);
        if (greenCards[cardNum].difficulty === 'easy' && [...greenSet].length < greenCardsNum) {
          greenSet.add(greenCards[cardNum]);
        } else if ([...greenSet].length < greenCardsNum && [...greenSet].length > 4 && greenCards[cardNum].difficulty === 'normal') {
          greenSet.add(greenCards[cardNum]);
        }
      }
      while ([...brownSet].length < brownCardsNum) {
        cardNum = random(brownNum);
        if (brownCards[cardNum].difficulty === 'easy' && [...brownSet].length < 5) {
          brownSet.add(brownCards[cardNum]);
        } else if ([...brownSet].length < brownCardsNum && [...brownSet].length > 4 && brownCards[cardNum].difficulty === 'normal') {
          brownSet.add(brownCards[cardNum]);
        }
      }
      while ([...blueSet].length < blueCardsNum) {
        cardNum = random(blueNum);
        if (blueCards[cardNum].difficulty === 'easy' && [...blueSet].length < blueCardsNum) {
          blueSet.add(blueCards[cardNum]);
        }
      }
      formedDeck = [...greenSet].concat([...brownSet], [...blueSet]);
    } else if (playDiff === 'Очень высокая') {
      while ([...greenSet].length < greenCardsNum) {
        cardNum = random(greenNum);
        if (greenCards[cardNum].difficulty === 'hard' && [...greenSet].length < greenCardsNum) {
          greenSet.add(greenCards[cardNum]);
        } else if ([...greenSet].length < greenCardsNum && [...greenSet].length > 4 && greenCards[cardNum].difficulty === 'normal') {
          greenSet.add(greenCards[cardNum]);
        }
      }
      while ([...brownSet].length < brownCardsNum) {
        cardNum = random(brownNum);
        if (brownCards[cardNum].difficulty === 'hard' && [...brownSet].length < 5) {
          brownSet.add(brownCards[cardNum]);
        } else if ([...brownSet].length < brownCardsNum && [...brownSet].length > 4 && brownCards[cardNum].difficulty === 'normal') {
          brownSet.add(brownCards[cardNum]);
        }
      }
      while ([...blueSet].length < blueCardsNum) {
        cardNum = random(blueNum);
        if (blueCards[cardNum].difficulty === 'hard' && [...blueSet].length < blueCardsNum) {
          blueSet.add(blueCards[cardNum]);
        }
      }
      formedDeck = [...greenSet].concat([...brownSet], [...blueSet]);
    }
}